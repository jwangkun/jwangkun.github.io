<!DOCTYPE html>
<html>
  <head>
      <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta content="yes" name="apple-mobile-web-app-capable" />
  <meta content="black" name="apple-mobile-web-app-status-bar-style" />
  <meta name="referrer" content="never">
  <meta name="keywords" content="">
  <meta name="description" content="">
  <meta name="author" content="kveln">
  <title>Centos7系统巡检 | John Wong&#39;s Blog</title>
  <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <!-- <link href="https://jwangkun.github.io/media/css/bootstrap.min.css" rel="stylesheet"> -->
  <!--  <link href="https://jwangkun.github.io/media/css/all.min.css" rel="stylesheet" type="text/css"> -->
  <link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.min.css" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
  <link rel="alternate" type="application/rss+xml" title="Centos7系统巡检 | John Wong&#39;s Blog » Feed" href="https://jwangkun.github.io/atom.xml">
  <link rel="stylesheet"href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/styles/androidstudio.min.css">
  <link href="https://jwangkun.github.io/styles/main.css" rel="stylesheet">
  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.15.10/build/highlight.min.js"></script>
  <!-- <script src="https://jwangkun.github.io/media/scripts/jquery.min.js"></script> -->
  <script>hljs.initHighlightingOnLoad();</script>
  

    <meta property="og:description" content="Centos7系统巡检"/>
    <meta property="og:url" content="https://jwangkun.github.io/diw1LvkpP/"/>
    <meta property="og:locale" content="zh-CN"/>
    <meta property="og:type" content="website"/>
    <meta property="og:site_name" content="John Wong&#39;s Blog"/>
  </head>
  <body>
  	<!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand" href="https://jwangkun.github.io">John Wong&#39;s Blog</a>
      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
        Menu
        <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          
          <li class="nav-item">
              
              <a class="nav-link" href="/">首页</a>
              
          </li>
          
          <li class="nav-item">
              
              <a class="nav-link" href="/archives">归档</a>
              
          </li>
          
          <li class="nav-item">
              
              <a class="nav-link" href="/tags">标签</a>
              
          </li>
          
          <li class="nav-item">
              
              <a class="nav-link" href="/about">关于</a>
              
          </li>
          
        </ul>
      </div>
    </div>
  </nav>
  <!-- Page Header -->
  <header class="masthead" style="background-image: url('https://jwangkun.github.io/media/images/home-bg.jpg')">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
          	<span class="tags">
          	 
            <a href="https://jwangkun.github.io/h1rmlqm_1/" class="tag">系统巡检</a>
            
            <a href="https://jwangkun.github.io/l-lwQxp4GJ/" class="tag">Centos</a>
            
        </span>
            <h1>Centos7系统巡检</h1>
            <span class="meta">
            	Posted on
              2020-11-10，37 min read
            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Post Content -->
  <article>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <p>这周闲得慌，就根据需求写了差不多20个脚本（部分是之前分享过的做了一些改进），今天主要分享一个给平时运维人员用的centos7系统巡检的脚本，或者排查问题检查系统情况也可以用..</p>
<h1 id="实用脚本">实用脚本</h1>
<pre><code>#!/bin/bash
##############################################################
# File Name: CenOS7.sh
# Version: V1.0
# Author: hwb
# Created Time : date
# Description: xunjian for centos7
##############################################################

#参数定义
date=`date +&quot;%Y-%m-%d-%H:%M:%S&quot;`
centosVersion=$(awk '{print $(NF-1)}' /etc/redhat-release)
VERSION=`date +%F`
#日志相关
LOGPATH=&quot;/tmp/awr&quot;
[ -e $LOGPATH ] || mkdir -p $LOGPATH
RESULTFILE=&quot;$LOGPATH/HostCheck-`hostname`-`date +%Y%m%d`.txt&quot;

#调用函数库
[ -f /etc/init.d/functions ] &amp;&amp; source /etc/init.d/functions
export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin
source /etc/profile


#root用户执行脚本
[ $(id -u) -gt 0 ] &amp;&amp; echo &quot;请用root用户执行此脚本！&quot; &amp;&amp; exit 1

 
function version(){
    echo &quot;&quot;
    echo &quot;&quot;
    echo &quot;[${date}] &gt;&gt;&gt; `hostname -s` 主机巡检&quot;
}


function getSystemStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m****************************************************系统检查****************************************************\033[0m&quot;
    if [ -e /etc/sysconfig/i18n ];then
        default_LANG=&quot;$(grep &quot;LANG=&quot; /etc/sysconfig/i18n | grep -v &quot;^#&quot; | awk -F '&quot;' '{print $2}')&quot;
    else
        default_LANG=$LANG
    fi
    export LANG=&quot;en_US.UTF-8&quot;
    Release=$(cat /etc/redhat-release 2&gt;/dev/null)
    Kernel=$(uname -r)
    OS=$(uname -o)
    Hostname=$(uname -n)
    SELinux=$(/usr/sbin/sestatus | grep &quot;SELinux status: &quot; | awk '{print $3}')
    LastReboot=$(who -b | awk '{print $3,$4}')
    uptime=$(uptime | sed 's/.*up \([^,]*\), .*/\1/')
    echo &quot;     系统：$OS&quot;
    echo &quot; 发行版本：$Release&quot;
    echo &quot;     内核：$Kernel&quot;
    echo &quot;   主机名：$Hostname&quot;
    echo &quot;  SELinux：$SELinux&quot;
    echo &quot;语言/编码：$default_LANG&quot;
    echo &quot; 当前时间：$(date +'%F %T')&quot;
    echo &quot; 最后启动：$LastReboot&quot;
    echo &quot; 运行时间：$uptime&quot;
    export LANG=&quot;$default_LANG&quot;
}

function getCpuStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m****************************************************CPU检查*****************************************************\033[0m&quot;
    Physical_CPUs=$(grep &quot;physical id&quot; /proc/cpuinfo| sort | uniq | wc -l)
    Virt_CPUs=$(grep &quot;processor&quot; /proc/cpuinfo | wc -l)
    CPU_Kernels=$(grep &quot;cores&quot; /proc/cpuinfo|uniq| awk -F ': ' '{print $2}')
    CPU_Type=$(grep &quot;model name&quot; /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq)
    CPU_Arch=$(uname -m)
    echo &quot;物理CPU个数:$Physical_CPUs&quot;
    echo &quot;逻辑CPU个数:$Virt_CPUs&quot;
    echo &quot;每CPU核心数:$CPU_Kernels&quot;
    echo &quot;    CPU型号:$CPU_Type&quot;
    echo &quot;    CPU架构:$CPU_Arch&quot;
}

function getMemStatus(){
    echo &quot;&quot;
    echo  -e &quot;\033[33m**************************************************内存检查*****************************************************\033[0m&quot;
    if [[ $centosVersion &lt; 7 ]];then
        free -mo
    else
        free -h
    fi
    #报表信息
    MemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}')  #KB
    MemFree=$(grep MemFree /proc/meminfo| awk '{print $2}')    #KB
    let MemUsed=MemTotal-MemFree
    MemPercent=$(awk &quot;BEGIN {if($MemTotal==0){printf 100}else{printf \&quot;%.2f\&quot;,$MemUsed*100/$MemTotal}}&quot;) 
}

function getDiskStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m**************************************************磁盘检查******************************************************\033[0m&quot;
    df -hiP | sed 's/Mounted on/Mounted/'&gt; /tmp/inode
    df -hTP | sed 's/Mounted on/Mounted/'&gt; /tmp/disk 
    join /tmp/disk /tmp/inode | awk '{print $1,$2,&quot;|&quot;,$3,$4,$5,$6,&quot;|&quot;,$8,$9,$10,$11,&quot;|&quot;,$12}'| column -t
    #报表信息
    diskdata=$(df -TP | sed '1d' | awk '$2!=&quot;tmpfs&quot;{print}') #KB
    disktotal=$(echo &quot;$diskdata&quot; | awk '{total+=$3}END{print total}') #KB
    diskused=$(echo &quot;$diskdata&quot; | awk '{total+=$4}END{print total}')  #KB
    diskfree=$((disktotal-diskused)) #KB
    diskusedpercent=$(echo $disktotal $diskused | awk '{if($1==0){printf 100}else{printf &quot;%.2f&quot;,$2*100/$1}}') 
    inodedata=$(df -iTP | sed '1d' | awk '$2!=&quot;tmpfs&quot;{print}')
    inodetotal=$(echo &quot;$inodedata&quot; | awk '{total+=$3}END{print total}')
    inodeused=$(echo &quot;$inodedata&quot; | awk '{total+=$4}END{print total}')
    inodefree=$((inodetotal-inodeused))
    inodeusedpercent=$(echo $inodetotal $inodeused | awk '{if($1==0){printf 100}else{printf &quot;%.2f&quot;,$2*100/$1}}')
}



function get_resource(){
    echo &quot;&quot;
    echo -e &quot;\033[33m**************************************************资源消耗统计**************************************************\033[0m&quot;

    echo -e &quot;\033[36m*************带宽资源消耗统计*************\033[0m&quot;
	#用数组存放网卡名
    nic=(`ifconfig | grep ^[a-z] | grep -vE 'lo|docker0'| awk -F: '{print $1}'`)
	time=`date &quot;+%Y-%m-%d %k:%M&quot;`
	num=0
	
    for ((i=0;i&lt;${#nic[@]};i++))
	do
	   #循环五次，避免看到的是偶然的数据
       while (( $num&lt;5 ))
	   do
	     rx_before=$(cat /proc/net/dev | grep '${nic[$i]}' | tr : &quot; &quot; | awk '{print $2}')
         tx_before=$(cat /proc/net/dev | grep '${nic[$i]}' | tr : &quot; &quot; | awk '{print $10}')
		 sleep 2
		 #用sed先获取第7列,再用awk获取第2列，再cut切割,从第7个到最后，即只切割网卡流量数字部分
         rx_after=$(cat /proc/net/dev | grep '${nic[$i]}' | tr : &quot; &quot; | awk '{print $2}')
         tx_after=$(cat /proc/net/dev | grep '${nic[$i]}' | tr : &quot; &quot; | awk '{print $10}')
		 #注意下面截取的相差2秒的两个时刻的累计和发送的bytes(即累计传送和接收的位)
         rx_result=$[(rx_after-rx_before)/1024/1024/2*8]
         tx_result=$[(tx_after-tx_before)/1024/1024/2*8]
		 echo  &quot;$time Now_In_Speed: $rx_result Mbps  Now_OUt_Speed: $tx_result Mbps&quot; &gt;&gt; /tmp/network.txt
		 let &quot;num++&quot;
	   done
	   #注意下面grep后面的$time变量要用双引号括起来
       rx_result=$(cat /tmp/network.txt|grep &quot;$time&quot;|awk '{In+=$4}END{print In}')
       tx_result=$(cat /tmp/network.txt|grep &quot;$time&quot;|awk '{Out+=$7}END{print Out}')
       In_Speed=$(echo &quot;scale=2;$rx_result/5&quot;|bc)
       Out_Speed=$(echo &quot;scale=2;$tx_result/5&quot;|bc)
       echo -e  &quot;\033[32m In_Speed_average: $In_Speed Mbps Out_Speed_average: $Out_Speed Mbps! \033[0m&quot; 
	done


    echo -e &quot;\033[36m*************CPU资源消耗统计*************\033[0m&quot;

    #使用vmstat 1 5命令统计5秒内的使用情况，再计算每秒使用情况
	total=`vmstat 1 5|awk '{x+=$13;y+=$14}END{print x+y}'`
	cpu_average=$(echo &quot;scale=2;$total/5&quot;|bc)
	
	#判断CPU使用率（浮点数与整数比较）
	if [ `echo &quot;${cpu_average} &gt; 70&quot; | bc` -eq 1 ];then
	    echo -e  &quot;\033[31m Total CPU is already use: ${cpu_average}%,请及时处理！\033[0m&quot; 
    else 
	    echo -e  &quot;\033[32m Total CPU is already use: ${cpu_average}%! \033[0m&quot; 
    fi


    echo -e &quot;\033[36m*************磁盘资源消耗统计*************\033[0m&quot;
    #磁盘使用情况(注意：需要用sed先进行格式化才能进行累加处理)
    disk_used=$(df -m | sed '1d;/ /!N;s/\n//;s/ \+/ /;' | awk '{used+=$3} END{print used}')
    disk_totalSpace=$(df -m | sed '1d;/ /!N;s/\n//;s/ \+/ /;' | awk '{totalSpace+=$2} END{print totalSpace}')
    disk_all=$(echo &quot;scale=4;$disk_used/$disk_totalSpace&quot; | bc)
    disk_percent1=$(echo $disk_all | cut -c 2-3)
    disk_percent2=$(echo $disk_all | cut -c 4-5)
    disk_warning=`df -m | sed '1d;/ /!N;s/\n//;s/ \+/ /;' | awk '{if ($5&gt;85) print $6 &quot;目录使用率：&quot; $5;} '`
    
	echo -e  &quot;\033[32m Total disk has used: $disk_percent1.$disk_percent2% \033[0m&quot; 
    #echo -e &quot;\t\t..&quot; 表示换行
	if [ -n  &quot;$disk_warning&quot; ];then
	    echo -e &quot;\033[31m${disk_warning} \n [Error]以上目录使用率超过85%，请及时处理！\033[0m&quot; 
	fi
	
    echo -e &quot;\033[36m*************内存资源消耗统计*************\033[0m&quot;
	
    #获得系统总内存
	memery_all=$(free -m | awk 'NR==2' | awk '{print $2}')
	#获得占用内存（操作系统 角度）
	system_memery_used=$(free -m | awk 'NR==2' | awk '{print $3}')
	#获得buffer、cache占用内存，当内存不够时会及时回收，所以这两部分可用于可用内存的计算
	buffer_used=$(free -m | awk 'NR==2' | awk '{print $6}')
	cache_used=$(free -m | awk 'NR==2' | awk '{print $7}')
	#获得被使用内存，所以这部分可用于可用内存的计算，注意计算方法
	actual_used_all=$[memery_all-(free+buffer_used+cache_used)]
	#获得实际占用的内存
	actual_used_all=`expr $memery_all - $free + $buffer_used + $cache_used `
    memery_percent=$(echo &quot;scale=4;$system_memery_used / $memery_all&quot; | bc)
    memery_percent2=$(echo &quot;scale=4; $actual_used_all / $memery_all&quot; | bc)
    percent_part1=$(echo $memery_percent | cut -c 2-3)
    percent_part2=$(echo $memery_percent | cut -c 4-5)
    percent_part11=$(echo $memery_percent2 | cut -c 2-3)
    percent_part22=$(echo $memery_percent2 | cut -c 4-5)
    
	#获得占用内存（操作系统角度）
    echo -e &quot;\033[32m system memery is already use: $percent_part1.$percent_part2% \033[0m&quot;
    #获得实际内存占用率
    echo -e &quot;\033[32m actual memery is already use: $percent_part11.$percent_part22% \033[0m&quot;
    echo -e &quot;\033[32m buffer is already used : $buffer_used M \033[0m&quot;
    echo -e &quot;\033[32m cache is already used : $cache_used M \033[0m&quot;
}



function getServiceStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m*************************************************服务检查*******************************************************\033[0m&quot;
    echo &quot;&quot;
    if [[ $centosVersion &gt; 7 ]];then
        conf=$(systemctl list-unit-files --type=service --state=enabled --no-pager | grep &quot;enabled&quot;)
        process=$(systemctl list-units --type=service --state=running --no-pager | grep &quot;.service&quot;)      
    else
        conf=$(/sbin/chkconfig | grep -E &quot;:on|:启用&quot;)
        process=$(/sbin/service --status-all 2&gt;/dev/null | grep -E &quot;is running|正在运行&quot;)        
    fi
	echo -e &quot;\033[36m******************服务配置******************\033[0m&quot;
    echo &quot;$conf&quot;  | column -t
    echo &quot;&quot;
	echo -e &quot;\033[36m**************正在运行的服务****************\033[0m&quot;
    echo &quot;$process&quot;
}


function getAutoStartStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m***********************************************自启动检查*******************************************************\033[0m&quot;
    echo -e &quot;\033[36m****************自启动命令*****************\033[0m&quot;
	conf=$(grep -v &quot;^#&quot; /etc/rc.d/rc.local| sed '/^$/d')
    echo &quot;$conf&quot;  
}


function getLoginStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m************************************************登录检查********************************************************\033[0m&quot;
    last | head 
}

function getNetworkStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m************************************************网络检查********************************************************\033[0m&quot;
    if [[ $centosVersion &lt; 7 ]];then
        /sbin/ifconfig -a | grep -v packets | grep -v collisions | grep -v i
		net6
    else
        #ip a
        for i in $(ip link | grep BROADCAST | awk -F: '{print $2}');do ip add show $i | grep -E &quot;BROADCAST|global&quot;| awk '{print $2}' | tr '\n' ' ' ;echo &quot;&quot; ;done
    fi
    GATEWAY=$(ip route | grep default | awk '{print $3}')
    DNS=$(grep nameserver /etc/resolv.conf| grep -v &quot;#&quot; | awk '{print $2}' | tr '\n' ',' | sed 's/,$//')
    echo &quot;&quot;
    echo &quot;网关：$GATEWAY &quot;
    echo &quot;DNS：$DNS&quot;
    #报表信息
    IP=$(ip -f inet addr | grep -v 127.0.0.1 |  grep inet | awk '{print $NF,$2}' | tr '\n' ',' | sed 's/,$//')
    MAC=$(ip link | grep -v &quot;LOOPBACK\|loopback&quot; | awk '{print $2}' | sed 'N;s/\n//' | tr '\n' ',' | sed 's/,$//')
    echo &quot;&quot;
ping -c 4 www.baidu.com &gt;/dev/null 2&gt;&amp;1
if [ $? -eq 0 ];then
   echo &quot;&quot;
   echo -e &quot;\033[32m网络连接：正常！\033[0m&quot; 
else
   echo &quot;&quot;
   echo -e &quot;\033[31m网络连接：异常！\033[0m&quot; 
fi 
}


function getListenStatus(){
    echo &quot;&quot;
    echo  -e &quot;\033[33m***********************************************监听检查********************************************************\033[0m&quot;
    TCPListen=$(ss -ntul | column -t)
    echo &quot;$TCPListen&quot;
}


function getCronStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m**********************************************计划任务检查******************************************************\033[0m&quot;
    Crontab=0
    for shell in $(grep -v &quot;/sbin/nologin&quot; /etc/shells);do
        for user in $(grep &quot;$shell&quot; /etc/passwd| awk -F: '{print $1}');do
            crontab -l -u $user &gt;/dev/null 2&gt;&amp;1
            status=$?
            if [ $status -eq 0 ];then
                echo -e &quot;\033[36m************$user用户的定时任务**************\033[0m&quot;
                crontab -l -u $user
                let Crontab=Crontab+$(crontab -l -u $user | wc -l)
                echo &quot;&quot;
            fi
        done
    done
    #计划任务
    #find /etc/cron* -type f | xargs -i ls -l {} | column  -t
    #let Crontab=Crontab+$(find /etc/cron* -type f | wc -l) 
}


function getHowLongAgo(){
    # 计算一个时间戳离现在有多久了
    datetime=&quot;$*&quot;
    [ -z &quot;$datetime&quot; ] &amp;&amp; echo `stat /etc/passwd|awk &quot;NR==6&quot;`
    Timestamp=$(date +%s -d &quot;$datetime&quot;)  
    Now_Timestamp=$(date +%s)
    Difference_Timestamp=$(($Now_Timestamp-$Timestamp))
    days=0;hours=0;minutes=0;
    sec_in_day=$((60*60*24));
    sec_in_hour=$((60*60));
    sec_in_minute=60
    while (( $(($Difference_Timestamp-$sec_in_day)) &gt; 1 ))
    do
        let Difference_Timestamp=Difference_Timestamp-sec_in_day
        let days++
    done
    while (( $(($Difference_Timestamp-$sec_in_hour)) &gt; 1 ))
    do
        let Difference_Timestamp=Difference_Timestamp-sec_in_hour
        let hours++
    done
    echo &quot;$days 天 $hours 小时前&quot;
}


function getUserLastLogin(){
    # 获取用户最近一次登录的时间，含年份
    # 很遗憾last命令不支持显示年份，只有&quot;last -t YYYYMMDDHHMMSS&quot;表示某个时间之间的登录，我
    # 们只能用最笨的方法了，对比今天之前和今年元旦之前（或者去年之前和前年之前……）某个用户
    # 登录次数，如果登录统计次数有变化，则说明最近一次登录是今年。
    username=$1
    : ${username:=&quot;`whoami`&quot;}
    thisYear=$(date +%Y)
    oldesYear=$(last | tail -n1 | awk '{print $NF}')
    while(( $thisYear &gt;= $oldesYear));do
        loginBeforeToday=$(last $username | grep $username | wc -l)
        loginBeforeNewYearsDayOfThisYear=$(last $username -t $thisYear&quot;0101000000&quot; | grep $username | wc -l)
        if [ $loginBeforeToday -eq 0 ];then
            echo &quot;从未登录过&quot;
            break
        elif [ $loginBeforeToday -gt $loginBeforeNewYearsDayOfThisYear ];then
            lastDateTime=$(last -i $username | head -n1 | awk '{for(i=4;i&lt;(NF-2);i++)printf&quot;%s &quot;,$i}')&quot; $thisYear&quot; 
            lastDateTime=$(date &quot;+%Y-%m-%d %H:%M:%S&quot; -d &quot;$lastDateTime&quot;)
            echo &quot;$lastDateTime&quot;
            break
        else
            thisYear=$((thisYear-1))
        fi
    done
}


function getUserStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m*************************************************用户检查*******************************************************\033[0m&quot;
    #/etc/passwd 最后修改时间
    pwdfile=&quot;$(cat /etc/passwd)&quot;
    Modify=$(stat /etc/passwd | grep Modify | tr '.' ' ' | awk '{print $2,$3}')
    echo &quot;/etc/passwd: $Modify ($(getHowLongAgo $Modify))&quot;
    echo &quot;&quot;
    echo -e &quot;\033[36m******************特权用户******************\033[0m&quot;
    RootUser=&quot;&quot;
    for user in $(echo &quot;$pwdfile&quot; | awk -F: '{print $1}');do
        if [ $(id -u $user) -eq 0 ];then
            echo &quot;$user&quot;
            RootUser=&quot;$RootUser,$user&quot;
        fi
    done
    echo &quot;&quot;
	echo -e &quot;\033[36m******************用户列表******************\033[0m&quot;
    USERs=0
    echo &quot;$(
    echo &quot;用户名 UID GID HOME SHELL 最后一次登录&quot;
    for shell in $(grep -v &quot;/sbin/nologin&quot; /etc/shells);do
        for username in $(grep &quot;$shell&quot; /etc/passwd| awk -F: '{print $1}');do
            userLastLogin=&quot;$(getUserLastLogin $username)&quot;
            echo &quot;$pwdfile&quot; | grep -w &quot;$username&quot; |grep -w &quot;$shell&quot;| awk -F: -v lastlogin=&quot;$(echo &quot;$userLastLogin&quot; | tr ' ' '_')&quot; '{print $1,$3,$4,$6,$7,lastlogin}'
        done
        let USERs=USERs+$(echo &quot;$pwdfile&quot; | grep &quot;$shell&quot;| wc -l)
    done
    )&quot; | column -t
    echo &quot;&quot;
	echo -e &quot;\033[36m******************空密码用户****************\033[0m&quot;
    USEREmptyPassword=&quot;&quot;
    for shell in $(grep -v &quot;/sbin/nologin&quot; /etc/shells);do
            for user in $(echo &quot;$pwdfile&quot; | grep &quot;$shell&quot; | cut -d: -f1);do
            r=$(awk -F: '$2==&quot;!!&quot;{print $1}' /etc/shadow | grep -w $user)
            if [ ! -z $r ];then
                echo $r
                USEREmptyPassword=&quot;$USEREmptyPassword,&quot;$r
            fi
        done    
    done
    echo &quot;&quot;
	echo -e &quot;\033[36m*****************相同ID用户*****************\033[0m&quot;
    USERTheSameUID=&quot;&quot;
    UIDs=$(cut -d: -f3 /etc/passwd | sort | uniq -c | awk '$1&gt;1{print $2}')
    for uid in $UIDs;do
        echo -n &quot;$uid&quot;;
        USERTheSameUID=&quot;$uid&quot;
        r=$(awk -F: 'ORS=&quot;&quot;;$3=='&quot;$uid&quot;'{print &quot;:&quot;,$1}' /etc/passwd)
        echo &quot;$r&quot;
        echo &quot;&quot;
        USERTheSameUID=&quot;$USERTheSameUID $r,&quot;
    done 
}


function getPasswordStatus {
    echo &quot;&quot;
    echo -e &quot;\033[33m*************************************************密码检查*******************************************************\033[0m&quot;
    pwdfile=&quot;$(cat /etc/passwd)&quot;
    echo &quot;&quot;
    echo -e &quot;\033[36m****************密码过期检查****************\033[0m&quot;
    result=&quot;&quot;
    for shell in $(grep -v &quot;/sbin/nologin&quot; /etc/shells);do
        for user in $(echo &quot;$pwdfile&quot; | grep &quot;$shell&quot; | cut -d: -f1);do
            get_expiry_date=$(/usr/bin/chage -l $user | grep 'Password expires' | cut -d: -f2)
            if [[ $get_expiry_date = ' never' || $get_expiry_date = 'never' ]];then
                printf &quot;%-15s 永不过期\n&quot; $user
                result=&quot;$result,$user:never&quot;
            else
                password_expiry_date=$(date -d &quot;$get_expiry_date&quot; &quot;+%s&quot;)
                current_date=$(date &quot;+%s&quot;)
                diff=$(($password_expiry_date-$current_date))
                let DAYS=$(($diff/(60*60*24)))
                printf &quot;%-15s %s天后过期\n&quot; $user $DAYS
                result=&quot;$result,$user:$DAYS days&quot;
            fi
        done
    done
    report_PasswordExpiry=$(echo $result | sed 's/^,//')
    echo &quot;&quot;
	echo -e &quot;\033[36m****************密码策略检查****************\033[0m&quot;
    grep -v &quot;#&quot; /etc/login.defs | grep -E &quot;PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE&quot;
}


function getSudoersStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m**********************************************Sudoers检查*******************************************************\033[0m&quot;
    conf=$(grep -v &quot;^#&quot; /etc/sudoers| grep -v &quot;^Defaults&quot; | sed '/^$/d')
    echo &quot;$conf&quot;
    echo &quot;&quot;
}


function getInstalledStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m*************************************************软件检查*******************************************************\033[0m&quot;
    rpm -qa --last | head | column -t 
}


function getProcessStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m*************************************************进程检查*******************************************************\033[0m&quot;
    if [ $(ps -ef | grep defunct | grep -v grep | wc -l) -ge 1 ];then
        echo &quot;&quot;
        echo -e &quot;\033[36m***************僵尸进程***************\033[0m&quot;
        ps -ef | head -n1
        ps -ef | grep defunct | grep -v grep
    fi
	echo &quot;&quot;
    echo -e &quot;\033[36m************CPU占用TOP 10进程*************\033[0m&quot;
    echo -e &quot;用户 进程ID %CPU 命令 
	$(ps aux | awk '{print $1, $2, $3, $11}' | sort -k3rn | head -n 10 )&quot;| column -t 
    echo &quot;&quot;
    echo -e &quot;\033[36m************内存占用TOP 10进程*************\033[0m&quot;
    echo -e &quot;用户 进程ID %MEM 虚拟内存  常驻内存 命令 
	$(ps aux | awk '{print $1, $2, $4, $5, $6, $11}' | sort -k3rn | head -n 10 )&quot;| column -t 
	#echo &quot;&quot;
    #echo -e &quot;\033[36m************SWAP占用TOP 10进程*************\033[0m&quot;
	#awk: fatal: cannot open file `/proc/18713/smaps' for reading (No such file or directory)
	#for i in `cd /proc;ls |grep &quot;^[0-9]&quot;|awk ' $0 &gt;100'`;do awk '{if (-f /proc/$i/smaps) print &quot;$i file is not exist&quot;; else print &quot;$i&quot;}';done
	#    for i in `cd /proc;ls |grep &quot;^[0-9]&quot;|awk ' $0 &gt;100'` ;do awk '/Swap:/{a=a+$2}END{print '&quot;$i&quot;',a/1024&quot;M&quot;}' /proc/$i/smaps ;done |sort -k2nr &gt; /tmp/swap.txt
	#echo -e &quot;进程ID SWAP使用 $(cat /tmp/swap.txt|grep -v awk | head -n 10)&quot;| column -t
}



function getSyslogStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m***********************************************syslog检查*******************************************************\033[0m&quot;
    echo &quot;SYSLOG服务状态：$(getState rsyslog)&quot;
    echo &quot;&quot;
    echo -e &quot;\033[36m***************rsyslog配置******************\033[0m&quot;
    cat /etc/rsyslog.conf 2&gt;/dev/null | grep -v &quot;^#&quot; | grep -v &quot;^\\$&quot; | sed '/^$/d'  | column -t
}


function getFirewallStatus(){
    echo &quot;&quot;
    echo -e &quot;\033[33m***********************************************防火墙检查*******************************************************\033[0m&quot;

    echo -e &quot;\033[36m****************防火墙状态******************\033[0m&quot;
    if [[ $centosVersion = 7 ]];then
        systemctl status firewalld &gt;/dev/null  2&gt;&amp;1
        status=$?
        if [ $status -eq 0 ];then
                s=&quot;active&quot;
        elif [ $status -eq 3 ];then
                s=&quot;inactive&quot;
        elif [ $status -eq 4 ];then
                s=&quot;permission denied&quot;
        else
                s=&quot;unknown&quot;
        fi
    else
        s=&quot;$(getState iptables)&quot;
    fi
    echo &quot;firewalld: $s&quot;
    echo &quot;&quot;
    echo -e &quot;\033[36m****************防火墙配置******************\033[0m&quot;
    cat /etc/sysconfig/firewalld 2&gt;/dev/null
}


function getSNMPStatus(){
    #SNMP服务状态，配置等
    echo &quot;&quot;
    echo -e &quot;\033[33m***********************************************SNMP检查*********************************************************\033[0m&quot;
    status=&quot;$(getState snmpd)&quot;
    echo &quot;SNMP服务状态：$status&quot;
    echo &quot;&quot;
    if [ -e /etc/snmp/snmpd.conf ];then
        echo &quot;/etc/snmp/snmpd.conf&quot;
        echo &quot;--------------------&quot;
        cat /etc/snmp/snmpd.conf 2&gt;/dev/null | grep -v &quot;^#&quot; | sed '/^$/d'
    fi
}


function getState(){
    if [[ $centosVersion &lt; 7 ]];then
        if [ -e &quot;/etc/init.d/$1&quot; ];then
            if [ `/etc/init.d/$1 status 2&gt;/dev/null | grep -E &quot;is running|正在运行&quot; | wc -l` -ge 1 ];then
                r=&quot;active&quot;
            else
                r=&quot;inactive&quot;
            fi
        else
            r=&quot;unknown&quot;
        fi
    else
        #CentOS 7+
        r=&quot;$(systemctl is-active $1 2&gt;&amp;1)&quot;
    fi
    echo &quot;$r&quot;
}


function getSSHStatus(){
    #SSHD服务状态，配置,受信任主机等
    echo &quot;&quot;
    echo -e &quot;\033[33m************************************************SSH检查*********************************************************\033[0m&quot;
    #检查受信任主机
    pwdfile=&quot;$(cat /etc/passwd)&quot;
    echo &quot;SSH服务状态：$(getState sshd)&quot;
    Protocol_Version=$(cat /etc/ssh/sshd_config | grep Protocol | awk '{print $2}')
    echo &quot;SSH协议版本：$Protocol_Version&quot;
    echo &quot;&quot;
    echo -e &quot;\033[36m****************信任主机******************\033[0m&quot;
    authorized=0
    for user in $(echo &quot;$pwdfile&quot; | grep /bin/bash | awk -F: '{print $1}');do
        authorize_file=$(echo &quot;$pwdfile&quot; | grep -w $user | awk -F: '{printf $6&quot;/.ssh/authorized_keys&quot;}')
        authorized_host=$(cat $authorize_file 2&gt;/dev/null | awk '{print $3}' | tr '\n' ',' | sed 's/,$//')
        if [ ! -z $authorized_host ];then
            echo &quot;$user 授权 \&quot;$authorized_host\&quot; 无密码访问&quot;
        fi
        let authorized=authorized+$(cat $authorize_file 2&gt;/dev/null | awk '{print $3}'|wc -l)
    done
    echo &quot;&quot;
    echo -e &quot;\033[36m*******是否允许ROOT远程登录***************\033[0m&quot;
    config=$(cat /etc/ssh/sshd_config | grep PermitRootLogin)
    firstChar=${config:0:1}
    if [ $firstChar == &quot;#&quot; ];then
        PermitRootLogin=&quot;yes&quot; 
    else
        PermitRootLogin=$(echo $config | awk '{print $2}')
    fi
    echo &quot;PermitRootLogin $PermitRootLogin&quot;
    echo &quot;&quot;
    echo -e &quot;\033[36m*************ssh服务配置******************\033[0m&quot;
    cat /etc/ssh/sshd_config | grep -v &quot;^#&quot; | sed '/^$/d'
}


function getNTPStatus(){
    #NTP服务状态，当前时间，配置等
    echo &quot;&quot;
    echo -e &quot;\033[33m***********************************************NTP检查**********************************************************\033[0m&quot;
    if [ -e /etc/ntp.conf ];then
        echo &quot;NTP服务状态：$(getState ntpd)&quot;
        echo &quot;&quot;
        echo -e &quot;\033[36m*************NTP服务配置******************\033[0m&quot;
        cat /etc/ntp.conf 2&gt;/dev/null | grep -v &quot;^#&quot; | sed '/^$/d'
    fi
}


function check(){
    version
    getSystemStatus
	get_resource
    getCpuStatus
    getMemStatus
    getDiskStatus
    getNetworkStatus
    getListenStatus
    getProcessStatus
    getServiceStatus
    getAutoStartStatus
    getLoginStatus
    getCronStatus
    getUserStatus
    getPasswordStatus
    getSudoersStatus
    getFirewallStatus
    getSSHStatus
    getSyslogStatus
    getSNMPStatus
    getNTPStatus
    getInstalledStatus
}
#执行检查并保存检查结果
check &gt; $RESULTFILE
echo -e &quot;\033[44;37m 主机巡检结果存放在：$RESULTFILE   \033[0m&quot;

#上传检查结果的文件
#curl -F &quot;filename=@$RESULTFILE&quot; &quot;$uploadHostDailyCheckApi&quot; 2&gt;/dev/null
cat $RESULTFILE
</code></pre>
<hr>
<p>执行脚本结果：</p>
<pre><code>[2020-11-10-14:54:03] &gt;&gt;&gt; HNGC-SVR-QCCBigDataSvr-Dev1 主机巡检

****************************************************系统检查****************************************************
     系统：GNU/Linux
 发行版本：CentOS Linux release 7.4.1708 (Core) 
     内核：3.10.0-693.el7.x86_64
   主机名：HNGC-SVR-QCCBigDataSvr-Dev1
  SELinux：disabled
语言/编码：zh_CN.UTF-8
 当前时间：2020-11-10 14:54:04
 最后启动：2020-02-06 23:35
 运行时间：277 days

**************************************************资源消耗统计**************************************************
*************带宽资源消耗统计*************
 In_Speed_average: 0 Mbps Out_Speed_average: 0 Mbps! 
 In_Speed_average: 0 Mbps Out_Speed_average: 0 Mbps! 
*************CPU资源消耗统计*************
 Total CPU is already use: 3.20%! 
*************磁盘资源消耗统计*************
 Total disk has used: 07.82% 
/目录使用率：91% 
 [Error]以上目录使用率超过85%，请及时处理！
*************内存资源消耗统计*************
 system memery is already use: 92.70% 
 actual memery is already use: 97.69% 
 buffer is already used : 1869 M 
 cache is already used : 1132 M 

****************************************************CPU检查*****************************************************
物理CPU个数:4
逻辑CPU个数:4
每CPU核心数:1
    CPU型号:Intel(R) Xeon(R) CPU E7-4809 v4 @ 2.10GHz
    CPU架构:x86_64

**************************************************内存检查*****************************************************
              total        used        free      shared  buff/cache   available
Mem:            31G         28G        466M        734M        1.8G        1.1G
Swap:           31G        9.4G         22G

**************************************************磁盘检查******************************************************
文件系统                 类型      |  容量   已用  可用  已用%  |  Inode  已用(I)  可用(I)  已用(I)%  |  挂载点
/dev/mapper/centos-root  xfs       |  50G    46G   4.9G  91%    |  10M    281K     9.8M     3%        |  /
devtmpfs                 devtmpfs  |  16G    0     16G   0%     |  4.0M   371      4.0M     1%        |  /dev
tmpfs                    tmpfs     |  16G    0     16G   0%     |  4.0M   1        4.0M     1%        |  /dev/shm
tmpfs                    tmpfs     |  16G    0     16G   0%     |  4.0M   670      4.0M     1%        |  /run
tmpfs                    tmpfs     |  16G    0     16G   0%     |  4.0M   16       4.0M     1%        |  /sys/fs/cgroup
tmpfs                    tmpfs     |  16G    1.6G  15G   10%    |  4.0M   1        4.0M     1%        |  /dev/shm
tmpfs                    tmpfs     |  16G    1.6G  15G   10%    |  4.0M   670      4.0M     1%        |  /run
tmpfs                    tmpfs     |  16G    1.6G  15G   10%    |  4.0M   16       4.0M     1%        |  /sys/fs/cgroup
tmpfs                    tmpfs     |  16G    0     16G   0%     |  4.0M   1        4.0M     1%        |  /dev/shm
tmpfs                    tmpfs     |  16G    0     16G   0%     |  4.0M   670      4.0M     1%        |  /run
tmpfs                    tmpfs     |  16G    0     16G   0%     |  4.0M   16       4.0M     1%        |  /sys/fs/cgroup
/dev/sda1                xfs       |  1014M  179M  836M  18%    |  512K   328      512K     1%        |  /boot
/dev/mapper/centos-home  xfs       |  518G   3.7G  514G  1%     |  259M   591      259M     1%        |  /home
tmpfs                    tmpfs     |  3.2G   0     3.2G  0%     |  4.0M   1        4.0M     1%        |  /run/user/0
cm_processes             tmpfs     |  16G    405M  16G   3%     |  4.0M   3.1K     4.0M     1%        |  /opt/cm-5.16.1/run/cloudera-scm-agent/process

************************************************网络检查********************************************************
ens192: 10.213.120.12/24 
virbr0: 192.168.122.1/24 
virbr0-nic: 

网关：10.213.120.254 
DNS：10.213.103.1


网络连接：正常！

***********************************************监听检查********************************************************
Netid  State   Recv-Q  Send-Q  Local                      Address:Port  Peer  Address:Port
udp    UNCONN  0       0       *:5353                     *:*
udp    UNCONN  0       0       *:55432                    *:*
udp    UNCONN  0       0       192.168.122.1:53           *:*
udp    UNCONN  0       0       *                          %virbr0:67    *:*
udp    UNCONN  0       0       *:111                      *:*
udp    UNCONN  0       0       127.0.0.1:323              *:*
udp    UNCONN  0       0       *:724                      *:*
udp    UNCONN  0       0       :::111                     :::*
udp    UNCONN  0       0       ::1:323                    :::*
udp    UNCONN  0       0       :::724                     :::*
tcp    LISTEN  0       50      *:7180                     *:*
tcp    LISTEN  0       128     *:9100                     *:*
tcp    LISTEN  0       50      *:7182                     *:*
tcp    LISTEN  0       128     *:111                      *:*
tcp    LISTEN  0       5       192.168.122.1:53           *:*
tcp    LISTEN  0       128     *:22                       *:*
tcp    LISTEN  0       128     127.0.0.1:631              *:*
tcp    LISTEN  0       100     127.0.0.1:25               *:*
tcp    LISTEN  0       100     :::10251                   :::*
tcp    LISTEN  0       100     :::9036                    :::*
tcp    LISTEN  0       100     :::10221                   :::*
tcp    LISTEN  0       128     :::5678                    :::*
tcp    LISTEN  0       128     :::111                     :::*
tcp    LISTEN  0       100     :::9040                    :::*
tcp    LISTEN  0       128     ::ffff:10.213.120.12:9200  :::*
tcp    LISTEN  0       100     :::9042                    :::*
tcp    LISTEN  0       100     :::9044                    :::*
tcp    LISTEN  0       100     :::10228                   :::*
tcp    LISTEN  0       128     ::ffff:10.213.120.12:9300  :::*
tcp    LISTEN  0       100     :::10229                   :::*
tcp    LISTEN  0       128     :::22                      :::*
tcp    LISTEN  0       100     :::9015                    :::*
tcp    LISTEN  0       128     ::1:631                    :::*
tcp    LISTEN  0       100     :::9016                    :::*
tcp    LISTEN  0       100     :::10232                   :::*
tcp    LISTEN  0       100     :::19032                   :::*
tcp    LISTEN  0       128     :::3000                    :::*
tcp    LISTEN  0       100     :::9017                    :::*
tcp    LISTEN  0       128     :::3001                    :::*
tcp    LISTEN  0       100     ::1:25                     :::*
tcp    LISTEN  0       100     :::9050                    :::*
tcp    LISTEN  0       100     :::10170                   :::*
tcp    LISTEN  0       100     :::10171                   :::*
tcp    LISTEN  0       100     :::9051                    :::*
tcp    LISTEN  0       100     :::10236                   :::*
tcp    LISTEN  0       100     :::9085                    :::*
tcp    LISTEN  0       100     :::10240                   :::*
tcp    LISTEN  0       100     :::10244                   :::*
tcp    LISTEN  0       100     :::9030                    :::*
tcp    LISTEN  0       100     :::9032                    :::*
tcp    LISTEN  0       100     :::19050                   :::*

*************************************************进程检查*******************************************************

************CPU占用TOP 10进程*************
用户  进程ID  %CPU  命令
root  14664   21.9  /opt/jdk1.8.0_171/bin/java
root  16429   9.3   /opt/jdk1.8.0_171/bin/java
root  17862   5.5   /opt/jdk1.8.0_171/bin/java
root  11472   1.4   /opt/jdk1.8.0_171/bin/java
root  26368   1.3   /opt/jdk1.8.0_171/bin/java
root  11562   1.2   /opt/jdk1.8.0_171/bin/java
root  21121   1.2   /opt/jdk1.8.0_171/bin/java
root  13636   1.0   /opt/jdk1.8.0_171/bin/java
root  21461   1.0   /opt/jdk1.8.0_171/bin/java
root  30492   1.0   /opt/jdk1.8.0_171/bin/java

************内存占用TOP 10进程*************
用户  进程ID  %MEM  虚拟内存  常驻内存  命令
root  14664   14.0  12573116  4607916   /opt/jdk1.8.0_171/bin/java
root  13636   9.8   12471352  3226696   /opt/jdk1.8.0_171/bin/java
root  22620   9.6   12197124  3150712   /opt/jdk1.8.0_171/bin/java
root  21461   9.4   12501464  3087064   /opt/jdk1.8.0_171/bin/java
root  11562   8.9   12517112  2919068   /opt/jdk1.8.0_171/bin/java
root  13295   8.9   12260592  2920060   /opt/jdk1.8.0_171/bin/java
root  16429   8.8   12394604  2897728   /opt/jdk1.8.0_171/bin/java
root  11472   7.0   12676872  2326028   /opt/jdk1.8.0_171/bin/java
root  21121   5.6   12233884  1865844   /opt/jdk1.8.0_171/bin/java
root  17862   3.6   6004648   1208716   /opt/jdk1.8.0_171/bin/java

*************************************************服务检查*******************************************************

******************服务配置******************
abrt-ccpp.service                            enabled
abrt-oops.service                            enabled
abrt-vmcore.service                          enabled
abrt-xorg.service                            enabled
abrtd.service                                enabled
accounts-daemon.service                      enabled
atd.service                                  enabled
auditd.service                               enabled
autovt@.service                              enabled
avahi-daemon.service                         enabled
bluetooth.service                            enabled
chronyd.service                              enabled
crond.service                                enabled
cups.service                                 enabled
dbus-org.bluez.service                       enabled
dbus-org.freedesktop.Avahi.service           enabled
dbus-org.freedesktop.ModemManager1.service   enabled
dbus-org.freedesktop.NetworkManager.service  enabled
dbus-org.freedesktop.nm-dispatcher.service   enabled
display-manager.service                      enabled
dmraid-activation.service                    enabled
gdm.service                                  enabled
getty@.service                               enabled
irqbalance.service                           enabled
iscsi.service                                enabled
kdump.service                                enabled
ksm.service                                  enabled
ksmtuned.service                             enabled
libstoragemgmt.service                       enabled
libvirtd.service                             enabled
lvm2-monitor.service                         enabled
mcelog.service                               enabled
mdmonitor.service                            enabled
microcode.service                            enabled
ModemManager.service                         enabled
multipathd.service                           enabled
NetworkManager-dispatcher.service            enabled
NetworkManager.service                       enabled
postfix.service                              enabled
qemu-guest-agent.service                     enabled
rngd.service                                 enabled
rsyslog.service                              enabled
rtkit-daemon.service                         enabled
smartd.service                               enabled
spice-vdagentd.service                       enabled
sshd.service                                 enabled
sysstat.service                              enabled
systemd-readahead-collect.service            enabled
systemd-readahead-drop.service               enabled
systemd-readahead-replay.service             enabled
tuned.service                                enabled
vgauthd.service                              enabled
vmtoolsd.service                             enabled

**************正在运行的服务****************
abrt-oops.service        loaded active running ABRT kernel log watcher
abrt-xorg.service        loaded active running ABRT Xorg log watcher
abrtd.service            loaded active running ABRT Automated Bug Reporting Tool
alsa-state.service       loaded active running Manage Sound Card State (restore and store)
atd.service              loaded active running Job spooling tools
auditd.service           loaded active running Security Auditing Service
avahi-daemon.service     loaded active running Avahi mDNS/DNS-SD Stack
chronyd.service          loaded active running NTP client/server
crond.service            loaded active running Command Scheduler
cups.service             loaded active running CUPS Printing Service
dbus.service             loaded active running D-Bus System Message Bus
getty@tty1.service       loaded active running Getty on tty1
gssproxy.service         loaded active running GSSAPI Proxy Daemon
irqbalance.service       loaded active running irqbalance daemon
ksmtuned.service         loaded active running Kernel Samepage Merging (KSM) Tuning Daemon
libstoragemgmt.service   loaded active running libstoragemgmt plug-in server daemon
libvirtd.service         loaded active running Virtualization daemon
lvm2-lvmetad.service     loaded active running LVM2 metadata daemon
mcelog.service           loaded active running Machine Check Exception Logging Daemon
ModemManager.service     loaded active running Modem Manager
NetworkManager.service   loaded active running Network Manager
packagekit.service       loaded active running PackageKit Daemon
polkit.service           loaded active running Authorization Manager
postfix.service          loaded active running Postfix Mail Transport Agent
rngd.service             loaded active running Hardware RNG Entropy Gatherer Daemon
rpcbind.service          loaded active running RPC bind service
rsyslog.service          loaded active running System Logging Service
smartd.service           loaded active running Self Monitoring and Reporting Technology (SMART) Daemon
sshd.service             loaded active running OpenSSH server daemon
systemd-journald.service loaded active running Journal Service
systemd-logind.service   loaded active running Login Service
systemd-udevd.service    loaded active running udev Kernel Device Manager
tuned.service            loaded active running Dynamic System Tuning Daemon
vgauthd.service          loaded active running VGAuth Service for open-vm-tools
vmtoolsd.service         loaded active running Service for virtual machines hosted on VMware

***********************************************自启动检查*******************************************************
****************自启动命令*****************
touch /var/lock/subsys/local
echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled

************************************************登录检查********************************************************

**********************************************计划任务检查******************************************************
************root用户的定时任务**************
@reboot	/opt/mysql/support-files/mysql.server start
@reboot /opt/cm-5.16.1/etc/init.d/cloudera-scm-server start
@reboot /opt/cm-5.16.1/etc/init.d/cloudera-scm-agent start


*************************************************用户检查*******************************************************
/etc/passwd:  (最近更改：2019-04-22 21:56:57.498721360 +0800
0 天 14 小时前)

******************特权用户******************
root

******************用户列表******************
用户名  UID   GID   HOME                       SHELL      最后一次登录
root    0     0     /root                      /bin/bash
hngc    1000  1000  /home/hngc                 /bin/bash
mysql   1001  1001  /home/mysql                /bin/bash
hdfs    989   983   /var/lib/hadoop-hdfs       /bin/bash
llama   986   980   /var/lib/llama             /bin/bash
httpfs  985   979   /var/lib/hadoop-httpfs     /bin/bash
mapred  984   978   /var/lib/hadoop-mapreduce  /bin/bash
yarn    982   976   /var/lib/hadoop-yarn       /bin/bash
kms     981   975   /var/lib/hadoop-kms        /bin/bash
impala  974   968   /var/lib/impala            /bin/bash
es      1002  1002  /home/es                   /bin/bash

******************空密码用户****************
mysql
hdfs
llama
httpfs
mapred
yarn
kms
impala
es

*****************相同ID用户*****************

*************************************************密码检查*******************************************************

****************密码过期检查****************
root            0天后过期
hngc            0天后过期
mysql           0天后过期
hdfs            0天后过期
llama           0天后过期
httpfs          0天后过期
mapred          0天后过期
yarn            0天后过期
kms             0天后过期
impala          0天后过期
es              0天后过期

****************密码策略检查****************
PASS_MAX_DAYS	99999
PASS_MIN_DAYS	0
PASS_MIN_LEN	5
PASS_WARN_AGE	7

**********************************************Sudoers检查*******************************************************
root	ALL=(ALL) 	ALL
%wheel	ALL=(ALL)	ALL


***********************************************防火墙检查*******************************************************
****************防火墙状态******************
firewalld: inactive

****************防火墙配置******************
# firewalld command line args
# possible values: --debug
FIREWALLD_ARGS=

************************************************SSH检查*********************************************************
SSH服务状态：active
SSH协议版本：

****************信任主机******************

*******是否允许ROOT远程登录***************
PermitRootLogin yes

*************ssh服务配置******************
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
HostKey /etc/ssh/ssh_host_ed25519_key
SyslogFacility AUTHPRIV
AuthorizedKeysFile	.ssh/authorized_keys
PasswordAuthentication yes
ChallengeResponseAuthentication no
GSSAPIAuthentication yes
GSSAPICleanupCredentials no
UsePAM yes
X11Forwarding yes
AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
AcceptEnv XMODIFIERS
Subsystem	sftp	/usr/libexec/openssh/sftp-server

***********************************************syslog检查*******************************************************
SYSLOG服务状态：active

***************rsyslog配置******************
*.info;mail.none;authpriv.none;cron.none  /var/log/messages
authpriv.*                                /var/log/secure
mail.*                                    -/var/log/maillog
cron.*                                    /var/log/cron
*.emerg                                   :omusrmsg:*
uucp,news.crit                            /var/log/spooler
local7.*                                  /var/log/boot.log

***********************************************SNMP检查*********************************************************
SNMP服务状态：unknown


***********************************************NTP检查**********************************************************

*************************************************软件检查*******************************************************
git-1.8.3.1-23.el7_8.x86_64                   2020年07月03日  星期五  23时04分12秒
perl-Git-1.8.3.1-23.el7_8.noarch              2020年07月03日  星期五  23时04分09秒
gpg-pubkey-f4a80eb5-53a7ff4b                  2020年07月03日  星期五  23时04分01秒
kibana-6.0.0-1.x86_64                         2019年04月22日  星期一  21时56分56秒
words-3.0-22.el7.noarch                       2018年05月07日  星期一  11时32分42秒
iwl7265-firmware-22.0.7.0-56.el7.noarch       2018年05月07日  星期一  11时32分42秒
iwl6050-firmware-41.28.5.1-56.el7.noarch      2018年05月07日  星期一  11时32分42秒
iwl6000g2b-firmware-17.168.5.2-56.el7.noarch  2018年05月07日  星期一  11时32分42秒
iwl6000g2a-firmware-17.168.5.3-56.el7.noarch  2018年05月07日  星期一  11时32分42秒
iwl6000-firmware-9.221.4.1-56.el7.noarch      2018年05月07日  星期一  11时32分42秒
[root@HNGC-SVR-QCCBigDataSvr-Dev1 ~]# 

</code></pre>

          
          <p class="next-post">下一篇：
            <a href="https://jwangkun.github.io/NGJc-76Gq/">
              <span class="post-title">
                Kubesphere3.0启用多集群&rarr;
              </span>
            </a>
          </p>
        
        <div class="comment">
          
        </div>
      </div>
    </div>
  </article>
 <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <ul class="list-inline text-center">
            
            
              
            
              
            
              
            
              
            
              
            
              
            
              
              <li class="list-inline-item">
              <a href="https://jwangkun.github.io/atom.xml" target="_blank">
                <span class="fa-stack fa-lg">
                  <i class="fas fa-circle fa-stack-2x"></i>
                  <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                </span>
              </a>
              </li>
          </ul>
          <p class="copyright text-muted">Copyright &copy;<span>John Wong&#39;s Blog</span><br><a href="https://github.com/getgridea/gridea" class="Themeinfo">Powered by Gridea</a></p>
        </div>
      </div>
    </div>
   </footer>
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <!-- <script src="https://jwangkun.github.io/media/scripts/bootstrap.bundle.min.js"></script> -->
  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.jsdelivr.net/gh/Alanrk/clean-cdn@1.0/scripts/clean-blog.min.js"></script>
  <!-- <script src="https://jwangkun.github.io/media/scripts/clean-blog.min.js"></script> -->
  <script src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
  <style type="text/css">a.back_to_top{text-decoration:none;position:fixed;bottom:40px;right:30px;background:#f0f0f0;height:40px;width:40px;border-radius:50%;line-height:36px;font-size:18px;text-align:center;transition-duration:.5s;transition-propety:background-color;display:none}a.back_to_top span{color:#888}a.back_to_top:hover{cursor:pointer;background:#dfdfdf}a.back_to_top:hover span{color:#555}@media print,screen and(max-width:580px){.back_to_top{display:none!important}}</style>
<a id="back_to_top" href="#" class="back_to_top">
  <span>▲</span></a>
<script>$(document).ready((function(_this) {
    return function() {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function() {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block')
          } else {
            return bt.css('display', 'none')
          }
        });
        return bt.click(function() {
          $('body,html').animate({
            scrollTop: 0
          },
          800);
          return false
        })
      }
    }
  })(this));
  var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?84ab85460bfbe79dbe5776a1df139a8f";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
  </script>
  
<script type="text/javascript" src="https://v1.cnzz.com/z_stat.php?id=1279350888&web_id=1279350888"></script>

  </body>
</html>

